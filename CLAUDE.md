# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

ECR Image Resolver is a GitHub Action that retrieves the latest image tag from an AWS ECR (Elastic Container Registry) repository. It's built with Node.js and uses the AWS SDK v3.

## Commands

### Build
```bash
npm run build
```
Compiles TypeScript to JavaScript in `lib/` then bundles using @vercel/ncc into a single file at `dist/index.js`

### Test
```bash
npm test
```
Runs the test suite using Jest with ts-jest

### Lint
```bash
npm run lint
```
Runs ESLint on all TypeScript files in the src directory

### Type Check
```bash
npm run typecheck
```
Runs TypeScript compiler to check types without emitting files

### Install Dependencies
```bash
npm install
```

## Architecture

The action follows GitHub Actions' JavaScript action structure:

- `action.yml` - Action metadata and input/output definitions
- `src/index.ts` - Main TypeScript entry point that:
  - Reads inputs using @actions/core with type safety
  - Creates an ECR client using AWS SDK v3
  - Queries ECR for images in the specified repository
  - Sorts images by push date to find the latest
  - Sets outputs with the latest image information
- `lib/` - Compiled TypeScript output (generated during build)
- `dist/` - Bundled action code (generated by build command)
- `tsconfig.json` - TypeScript configuration with strict mode enabled

## Key Implementation Details

1. The action authenticates using AWS credentials that must be configured before running (typically using aws-actions/configure-aws-credentials)
2. It filters for TAGGED images only to avoid untagged images
3. Images are sorted by `imagePushedAt` timestamp to determine the latest
4. The action outputs:
   - `latest-tag`: The tag of the most recently pushed image
   - `latest-image-uri`: Full ECR URI for pulling the image
   - `image-digest`: SHA256 digest of the image